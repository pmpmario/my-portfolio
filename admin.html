<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Login</title>
<script>
const urlParams = new URLSearchParams(window.location.search);
const code = urlParams.get('code');

if (!code) {
    window.location.href = "login.html";
} else {
    // Call Netlify serverless function to exchange code for token
    fetch(`/.netlify/functions/oauth-callback?code=${code}`)
    .then(res => res.json())
    .then(data => {
        if (data.access_token) {
            sessionStorage.setItem("adminToken", data.access_token);
            window.location.href = "index.html"; // Redirect to portfolio with admin controls
        } else {
            alert("Failed to login: " + (data.message || "Unknown error"));
            window.location.href = "login.html";
        }
    })
    .catch(err => {
        alert("Error during login: " + err.message);
        window.location.href = "login.html";
    });
}
</script>
</head>
<body>
<p>Logging in, please wait...</p>
</body>
</html>
